#include <Arduino_FreeRTOS.h>

void TaskLED(void *pvParameters);
void TaskButtons(void *pvParameters);

// Example pin definitions
const int ledPins[2][3][3] = {
                                {
                                  {2, 3, 4},
                                  {5, 6, 7},
                                  {8, 9, 10}
                                },
                                {
                                  {11, 12, 13},
                                  {A0, A1, A2},
                                  {A3, A4, A5}
                                }
                              };
const int buttonPins[7] = {2, 3, 4, 5, 6, 7, 8};
const int touchPin = A0;
const int piezoPin = 8;

struct RGB {
  uint8_t r, g, b;
};

//animation, frame, RGBled
const RGB animations[][6][6] PROGMEM = {
  // 1. Pride (Rainbow)
  {
    { {228,3,3},{255,140,0},{255,237,0},{0,128,38},{0,77,255},{117,7,135} },
    { {255,140,0},{255,237,0},{0,128,38},{0,77,255},{117,7,135},{228,3,3} },
    { {255,237,0},{0,128,38},{0,77,255},{117,7,135},{228,3,3},{255,140,0} },
    { {0,128,38},{0,77,255},{117,7,135},{228,3,3},{255,140,0},{255,237,0} },
    { {0,77,255},{117,7,135},{228,3,3},{255,140,0},{255,237,0},{0,128,38} },
    { {117,7,135},{228,3,3},{255,140,0},{255,237,0},{0,128,38},{0,77,255} }
  },

  // 2. Transgender
  {
    { {91,206,250},{245,169,184},{255,255,255},{245,169,184},{91,206,250},{255,255,255} },
    { {245,169,184},{255,255,255},{245,169,184},{91,206,250},{255,255,255},{91,206,250} },
    { {255,255,255},{245,169,184},{91,206,250},{255,255,255},{91,206,250},{245,169,184} },
    { {245,169,184},{91,206,250},{255,255,255},{91,206,250},{245,169,184},{255,255,255} },
    { {91,206,250},{255,255,255},{91,206,250},{245,169,184},{255,255,255},{245,169,184} },
    { {255,255,255},{91,206,250},{245,169,184},{255,255,255},{245,169,184},{91,206,250} }
  },

  // 3. Lesbian
  {
    { {213,45,0},{239,118,39},{255,255,255},{206,98,163},{181,86,144},{163,2,98} },
    { {239,118,39},{255,255,255},{206,98,163},{181,86,144},{163,2,98},{213,45,0} },
    { {255,255,255},{206,98,163},{181,86,144},{163,2,98},{213,45,0},{239,118,39} },
    { {206,98,163},{181,86,144},{163,2,98},{213,45,0},{239,118,39},{255,255,255} },
    { {181,86,144},{163,2,98},{213,45,0},{239,118,39},{255,255,255},{206,98,163} },
    { {163,2,98},{213,45,0},{239,118,39},{255,255,255},{206,98,163},{181,86,144} }
  },

  // 4. Bisexual
  {
    { {214,2,112},{214,2,112},{155,79,150},{155,79,150},{0,56,168},{0,56,168} },
    { {214,2,112},{155,79,150},{155,79,150},{0,56,168},{0,56,168},{214,2,112} },
    { {155,79,150},{155,79,150},{0,56,168},{0,56,168},{214,2,112},{214,2,112} },
    { {155,79,150},{0,56,168},{0,56,168},{214,2,112},{214,2,112},{155,79,150} },
    { {0,56,168},{0,56,168},{214,2,112},{214,2,112},{155,79,150},{155,79,150} },
    { {0,56,168},{214,2,112},{214,2,112},{155,79,150},{155,79,150},{0,56,168} }
  },

  // 5. Nonbinary
  {
    { {255,244,48},{255,255,255},{156,89,209},{0,0,0},{156,89,209},{255,244,48} },
    { {255,255,255},{156,89,209},{0,0,0},{156,89,209},{255,244,48},{255,255,255} },
    { {156,89,209},{0,0,0},{156,89,209},{255,244,48},{255,255,255},{156,89,209} },
    { {0,0,0},{156,89,209},{255,244,48},{255,255,255},{156,89,209},{0,0,0} },
    { {156,89,209},{255,244,48},{255,255,255},{156,89,209},{0,0,0},{156,89,209} },
    { {255,244,48},{255,255,255},{156,89,209},{0,0,0},{156,89,209},{255,244,48} }
  },

  // 6. Pansexual
  {
    { {0,0,0},{255,0,0},{255,255,255},{255,255,0},{128,0,128},{0,0,255} },
    { {255,0,0},{255,255,255},{255,255,0},{128,0,128},{0,0,255},{0,0,0} },
    { {255,255,255},{255,255,0},{128,0,128},{0,0,255},{0,0,0},{255,0,0} },
    { {255,255,0},{128,0,128},{0,0,255},{0,0,0},{255,0,0},{255,255,255} },
    { {128,0,128},{0,0,255},{0,0,0},{255,0,0},{255,255,255},{255,255,0} },
    { {0,0,255},{0,0,0},{255,0,0},{255,255,255},{255,255,0},{128,0,128} }
  },
  // 7. Rainbow Pulse Wave
  {
    { {114,1,1},{127,70,0},{127,118,0},{0,64,19},{0,38,127},{59,3,68} },
    { {171,2,2},{191,105,0},{191,177,0},{0,96,29},{0,58,191},{88,5,101} },
    { {228,3,3},{255,140,0},{255,237,0},{0,128,38},{0,77,255},{117,7,135} },
    { {171,2,2},{191,105,0},{191,177,0},{0,96,29},{0,58,191},{88,5,101} },
    { {114,1,1},{127,70,0},{127,118,0},{0,64,19},{0,38,127},{59,3,68} },
    { {0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0} }
  },

  // 8. Transgender Sliding Stripe
  {
    { {255,255,255},{91,206,250},{245,169,184},{255,255,255},{245,169,184},{91,206,250} },
    { {91,206,250},{245,169,184},{255,255,255},{245,169,184},{91,206,250},{255,255,255} },
    { {245,169,184},{255,255,255},{245,169,184},{91,206,250},{255,255,255},{91,206,250} },
    { {255,255,255},{245,169,184},{91,206,250},{255,255,255},{91,206,250},{245,169,184} },
    { {245,169,184},{91,206,250},{255,255,255},{91,206,250},{245,169,184},{255,255,255} },
    { {91,206,250},{255,255,255},{91,206,250},{245,169,184},{255,255,255},{245,169,184} }
  },

  // 9. Lesbian Pulse Flash
  {
    { {0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0} },
    { {107,22,0},{120,59,20},{127,127,127},{103,49,81},{90,43,72},{81,1,49} },
    { {213,45,0},{239,118,39},{255,255,255},{206,98,163},{181,86,144},{163,2,98} },
    { {107,22,0},{120,59,20},{127,127,127},{103,49,81},{90,43,72},{81,1,49} },
    { {0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0} },
    { {213,45,0},{239,118,39},{255,255,255},{206,98,163},{181,86,144},{163,2,98} }
  },

  // 10. Bisexual Bouncing Ends
  {
    { {0,0,0},{0,0,0},{155,79,150},{155,79,150},{0,0,0},{0,0,0} },
    { {214,2,112},{0,0,0},{155,79,150},{155,79,150},{0,0,0},{0,56,168} },
    { {214,2,112},{214,2,112},{155,79,150},{155,79,150},{0,56,168},{0,56,168} },
    { {0,0,0},{214,2,112},{155,79,150},{155,79,150},{0,56,168},{0,0,0} },
    { {0,0,0},{0,0,0},{155,79,150},{155,79,150},{0,0,0},{0,0,0} },
    { {0,0,0},{214,2,112},{155,79,150},{155,79,150},{0,56,168},{0,0,0} }
  },

  // 11. Nonbinary Gradient Flash
  {
    { {127,122,24},{127,127,127},{78,44,105},{0,0,0},{78,44,105},{127,122,24} },
    { {191,183,36},{191,191,191},{117,67,157},{0,0,0},{117,67,157},{191,183,36} },
    { {255,244,48},{255,255,255},{156,89,209},{0,0,0},{156,89,209},{255,244,48} },
    { {191,183,36},{191,191,191},{117,67,157},{0,0,0},{117,67,157},{191,183,36} },
    { {127,122,24},{127,127,127},{78,44,105},{0,0,0},{78,44,105},{127,122,24} },
    { {0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0} }
  },

  // 12. Pansexual Flicker Sparkle
  {
    { {0,0,0},{255,0,0},{0,0,0},{255,255,0},{0,0,0},{0,0,255} },
    { {255,0,0},{0,0,0},{255,255,255},{0,0,0},{128,0,128},{0,0,0} },
    { {0,0,0},{255,0,0},{255,255,255},{255,255,0},{128,0,128},{0,0,255} },
    { {255,0,0},{0,0,0},{255,255,255},{0,0,0},{128,0,128},{0,0,0} },
    { {0,0,0},{255,0,0},{0,0,0},{255,255,0},{0,0,0},{0,0,255} },
    { {0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0} }
  }
};


void TaskLED(void *pvParameters) {
  while (1) {
    // Replace this with your RGB LED animation code
    // Avoid using delay(); use vTaskDelay instead
    Serial.println("Animating LEDs...");
    vTaskDelay(50 / portTICK_PERIOD_MS);
  }
}

void TaskButtons(void *pvParameters) {
  while (1) {
    for (int i = 0; i < 6; i++) {
      if (digitalRead(buttonPins[i]) == LOW) {
        tone(piezoPin, 440 + i * 50);  // Simple frequency mapping
        vTaskDelay(100 / portTICK_PERIOD_MS);
        noTone(piezoPin);
      }
    }

    if (analogRead(touchPin) > 500) {
      tone(piezoPin, 880);
      vTaskDelay(100 / portTICK_PERIOD_MS);
      noTone(piezoPin);
    }

    vTaskDelay(10 / portTICK_PERIOD_MS);  // Prevent hogging the CPU
  }
}


void setup() {
  Serial.begin(9600);

  // Setup pins
  for (int i = 0; i < 6; i++) pinMode(buttonPins[i], INPUT_PULLUP);
  pinMode(touchPin, INPUT);
  pinMode(piezoPin, OUTPUT);

  // Create tasks
  xTaskCreate(TaskLED, "LED", 128, NULL, 1, NULL);
  xTaskCreate(TaskButtons, "Buttons", 128, NULL, 1, NULL);
}

void loop() {
  // Not used with FreeRTOS
}
